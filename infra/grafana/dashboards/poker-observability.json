{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "User Journey & Sessions",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 1 },
      "id": 101,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "poker_active_connections",
          "legendFormat": "Active Users",
          "refId": "A"
        }
      ],
      "title": "Active Users",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 1 },
      "id": 102,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_session_duration_seconds_sum[5m])) / sum(rate(poker_session_duration_seconds_count[5m]))",
          "legendFormat": "Avg Session Duration",
          "refId": "A"
        }
      ],
      "title": "Avg Session Duration",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 1 },
      "id": 103,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_session_hands_played_sum[5m])) / sum(rate(poker_session_hands_played_count[5m]))",
          "legendFormat": "Hands per Session",
          "refId": "A"
        }
      ],
      "title": "Avg Hands per Session",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 1 },
      "id": 104,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_sessions_total[5m])) * 300",
          "legendFormat": "Sessions (5m)",
          "refId": "A"
        }
      ],
      "title": "New Sessions (5m)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 7 },
      "id": 200,
      "title": "User Friction Points",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 8 },
      "id": 201,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (reason) (rate(poker_seat_join_failures_total[5m]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "title": "Seat Join Failures by Reason",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 8 },
      "id": 202,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (reason) (rate(poker_action_rejections_total[5m]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "title": "Action Rejections by Reason",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 8 },
      "id": 203,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(poker_turn_timeouts_total[5m])",
          "legendFormat": "Turn Timeouts",
          "refId": "A"
        },
        {
          "expr": "rate(poker_action_time_exceeded_total[5m])",
          "legendFormat": "Late Actions (>80% timer)",
          "refId": "B"
        },
        {
          "expr": "rate(poker_ws_reconnects_total[5m])",
          "legendFormat": "WS Reconnects",
          "refId": "C"
        }
      ],
      "title": "Time Pressure & Connection Issues",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 16 },
      "id": 300,
      "title": "Player Quality & Engagement",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "percentunit", "min": 0, "max": 1 },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 17 },
      "id": 301,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_vpip_actions_total[5m])) / sum(rate(poker_hands_started_total[5m]))",
          "legendFormat": "VPIP",
          "refId": "A"
        }
      ],
      "title": "VPIP (Voluntarily Put $ In Pot)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "percentunit", "min": 0, "max": 1 },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 17 },
      "id": 302,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_pfr_actions_total[5m])) / sum(rate(poker_hands_started_total[5m]))",
          "legendFormat": "PFR",
          "refId": "A"
        }
      ],
      "title": "PFR (Pre-Flop Raise)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 17 },
      "id": 303,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_decision_time_seconds_sum[5m])) / sum(rate(poker_decision_time_seconds_count[5m]))",
          "legendFormat": "Avg Decision Time",
          "refId": "A"
        }
      ],
      "title": "Avg Decision Time",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "percentunit", "min": 0, "max": 1 },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 17 },
      "id": 304,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(rate(poker_hands_won_total[5m])) / sum(rate(poker_hands_ended_total[5m]))",
          "legendFormat": "Win Rate",
          "refId": "A"
        }
      ],
      "title": "Win Rate",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 23 },
      "id": 305,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(poker_vpip_actions_total[5m])",
          "legendFormat": "VPIP Actions",
          "refId": "A"
        },
        {
          "expr": "rate(poker_pfr_actions_total[5m])",
          "legendFormat": "PFR Actions",
          "refId": "B"
        },
        {
          "expr": "rate(poker_allin_actions_total[5m])",
          "legendFormat": "All-ins",
          "refId": "C"
        },
        {
          "expr": "rate(poker_fold_to_raise_total[5m])",
          "legendFormat": "Fold to Raise",
          "refId": "D"
        }
      ],
      "title": "Player Action Patterns",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 23 },
      "id": 306,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(poker_hands_won_total[5m])",
          "legendFormat": "Hands Won",
          "refId": "A"
        },
        {
          "expr": "rate(poker_showdown_wins_total[5m])",
          "legendFormat": "Showdown Wins",
          "refId": "B"
        },
        {
          "expr": "rate(poker_hands_won_total[5m]) - rate(poker_showdown_wins_total[5m])",
          "legendFormat": "Non-Showdown Wins",
          "refId": "C"
        }
      ],
      "title": "Win Breakdown",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 31 },
      "id": 400,
      "title": "Game Flow & Activity",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "id": 1,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "poker_actions_total",
          "legendFormat": "actions",
          "refId": "A"
        }
      ],
      "title": "Poker Actions Total",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "id": 2,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "poker_active_connections",
          "legendFormat": "connections",
          "refId": "A"
        }
      ],
      "title": "Active Connections",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "id": 3,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (type) (rate(poker_actions_by_type_total[5m]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ],
      "title": "Actions by Type (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "id": 5,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(poker_hands_started_total[5m])",
          "legendFormat": "started",
          "refId": "A"
        },
        {
          "expr": "rate(poker_hands_ended_total[5m])",
          "legendFormat": "ended",
          "refId": "B"
        }
      ],
      "title": "Hands Started vs Ended (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 48 },
      "id": 6,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(poker_hand_duration_seconds_sum[5m])) / sum(rate(poker_hand_duration_seconds_count[5m]))",
          "legendFormat": "avg",
          "refId": "A"
        },
        {
          "expr": "poker_hand_duration_seconds_max",
          "legendFormat": "max",
          "refId": "B"
        }
      ],
      "title": "Hand Duration (seconds)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 48 },
      "id": 10,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "rate(poker_table_joins_total[5m])",
          "legendFormat": "joins",
          "refId": "A"
        },
        {
          "expr": "rate(poker_table_leaves_total[5m])",
          "legendFormat": "leaves",
          "refId": "B"
        }
      ],
      "title": "Seat Joins vs Leaves (5m rate)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 56 },
      "id": 500,
      "title": "System Health",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 57 },
      "id": 8,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (channel) (rate(poker_rate_limit_total[5m]))",
          "legendFormat": "{{channel}}",
          "refId": "A"
        }
      ],
      "title": "Rate Limit Events (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 57 },
      "id": 9,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (type) (rate(poker_ws_messages_total[5m]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ],
      "title": "WebSocket Messages (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 57 },
      "id": 11,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "poker_active_table_subscriptions",
          "legendFormat": "table subscriptions",
          "refId": "A"
        },
        {
          "expr": "poker_active_chat_subscriptions",
          "legendFormat": "chat subscriptions",
          "refId": "B"
        }
      ],
      "title": "Active Subscriptions",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 65 },
      "id": 12,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (reason) (rate(poker_chat_errors_total[5m]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "title": "Chat Errors (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 65 },
      "id": 501,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (code) (rate(poker_ws_errors_total[5m]))",
          "legendFormat": "{{code}}",
          "refId": "A"
        }
      ],
      "title": "WebSocket Errors by Code",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 73 },
      "id": 600,
      "title": "Logs & Traces",
      "type": "row"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "LOKI"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 74 },
      "id": 601,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(count_over_time({service=~\".+\"}[$__interval]))",
          "refId": "A"
        }
      ],
      "title": "Log Volume",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "LOKI"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 74 },
      "id": 602,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(count_over_time({service=~\".+\"} |= \"error\" [$__interval]))",
          "refId": "A"
        }
      ],
      "title": "Error Logs (interval)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "LOKI"
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 82 },
      "id": 603,
      "options": {
        "dedupStrategy": "none",
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [
        {
          "expr": "{service=~\".+\"}",
          "refId": "A"
        }
      ],
      "title": "Recent Logs",
      "type": "logs"
    },
    {
      "datasource": {
        "type": "tempo",
        "uid": "TEMPO"
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 92 },
      "id": 604,
      "targets": [
        {
          "queryType": "search",
          "query": "{}",
          "refId": "A"
        }
      ],
      "title": "Recent Traces",
      "type": "traces"
    }
  ],
  "refresh": "10s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["poker", "ux"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "title": "Poker Observability",
  "uid": "poker-observability",
  "version": 3
}
