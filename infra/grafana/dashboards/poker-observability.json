{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "Gameplay Snapshot",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 1 },
      "id": 101,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "game_active_tables",
          "legendFormat": "Active Tables",
          "refId": "A"
        }
      ],
      "title": "Active Tables",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
      "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 1 },
      "id": 102,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "(sum(rate(game_turn_duration_seconds_sum[5m])) / clamp_min(sum(rate(game_turn_duration_seconds_count[5m])), 1)) or vector(0)",
          "legendFormat": "Avg Turn Duration",
          "refId": "A"
        }
      ],
      "title": "Avg Turn Duration",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 1 },
      "id": 103,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(increase(game_actions_processed_total[5m])) or vector(0)",
          "legendFormat": "Actions (5m)",
          "refId": "A"
        }
      ],
      "title": "Actions (5m)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 1 },
      "id": 104,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(increase(game_hands_started_total[5m])) or vector(0)",
          "legendFormat": "Hands Started (5m)",
          "refId": "A"
        }
      ],
      "title": "Hands Started (5m)",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 7 },
      "id": 200,
      "title": "Service Latency & Errors",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 8 },
      "id": 201,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(game_grpc_request_duration_seconds_sum[5m])) / clamp_min(sum(rate(game_grpc_request_duration_seconds_count[5m])), 1)",
          "legendFormat": "game",
          "refId": "A"
        },
        {
          "expr": "sum(rate(balance_grpc_request_duration_seconds_sum[5m])) / clamp_min(sum(rate(balance_grpc_request_duration_seconds_count[5m])), 1)",
          "legendFormat": "balance",
          "refId": "B"
        },
        {
          "expr": "sum(rate(player_grpc_request_duration_seconds_sum[5m])) / clamp_min(sum(rate(player_grpc_request_duration_seconds_count[5m])), 1)",
          "legendFormat": "player",
          "refId": "C"
        },
        {
          "expr": "sum(rate(notify_grpc_request_duration_seconds_sum[5m])) / clamp_min(sum(rate(notify_grpc_request_duration_seconds_count[5m])), 1)",
          "legendFormat": "notify",
          "refId": "D"
        }
      ],
      "title": "Average gRPC Latency (seconds)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 8 },
      "id": 202,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(game_grpc_request_duration_seconds_count{status=\"error\"}[5m])) or vector(0)",
          "legendFormat": "game",
          "refId": "A"
        },
        {
          "expr": "sum(rate(balance_grpc_request_duration_seconds_count{status=\"error\"}[5m])) or vector(0)",
          "legendFormat": "balance",
          "refId": "B"
        },
        {
          "expr": "sum(rate(player_grpc_request_duration_seconds_count{status=\"error\"}[5m])) or vector(0)",
          "legendFormat": "player",
          "refId": "C"
        },
        {
          "expr": "sum(rate(notify_grpc_request_duration_seconds_count{status=\"error\"}[5m])) or vector(0)",
          "legendFormat": "notify",
          "refId": "D"
        }
      ],
      "title": "gRPC Errors (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 8 },
      "id": 203,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(game_turn_duration_seconds_sum[5m])) / clamp_min(sum(rate(game_turn_duration_seconds_count[5m])), 1)",
          "legendFormat": "avg",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(game_turn_duration_seconds_bucket[5m])) by (le))",
          "legendFormat": "p95",
          "refId": "B"
        }
      ],
      "title": "Turn Duration (avg/p95)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 16 },
      "id": 300,
      "title": "Player Service Activity",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 0, "y": 17 },
      "id": 301,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(increase(player_profile_lookups_total[5m]))",
          "legendFormat": "Profile Lookups (5m)",
          "refId": "A"
        }
      ],
      "title": "Profile Lookups (5m)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 6, "y": 17 },
      "id": 302,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(increase(player_profile_updates_total[5m]))",
          "legendFormat": "Profile Updates (5m)",
          "refId": "A"
        }
      ],
      "title": "Profile Updates (5m)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 12, "y": 17 },
      "id": 303,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(increase(player_friend_mutations_total[5m]))",
          "legendFormat": "Friend Mutations (5m)",
          "refId": "A"
        }
      ],
      "title": "Friend Mutations (5m)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 6, "w": 6, "x": 18, "y": 17 },
      "id": 304,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(increase(player_statistics_updates_total[5m]))",
          "legendFormat": "Stats Updates (5m)",
          "refId": "A"
        }
      ],
      "title": "Stats Updates (5m)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 23 },
      "id": 305,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (status) (rate(player_profile_lookups_total[5m]))",
          "legendFormat": "lookups {{status}}",
          "refId": "A"
        },
        {
          "expr": "sum by (status) (rate(player_profile_updates_total[5m]))",
          "legendFormat": "updates {{status}}",
          "refId": "B"
        }
      ],
      "title": "Profile Requests by Status",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 23 },
      "id": 306,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(player_grpc_request_duration_seconds_sum[5m])) / sum(rate(player_grpc_request_duration_seconds_count[5m]))",
          "legendFormat": "avg",
          "refId": "A"
        }
      ],
      "title": "Player gRPC Latency (avg)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 31 },
      "id": 400,
      "title": "Game Flow & Activity",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 32 },
      "id": 1,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (action_type) (rate(game_actions_processed_total[5m]))",
          "legendFormat": "{{action_type}}",
          "refId": "A"
        }
      ],
      "title": "Actions by Type (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 32 },
      "id": 2,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "game_active_tables",
          "legendFormat": "tables",
          "refId": "A"
        },
        {
          "expr": "game_seated_players",
          "legendFormat": "seated players",
          "refId": "B"
        }
      ],
      "title": "Active Tables & Seated Players",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "id": 3,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(rate(game_hands_started_total[5m]))",
          "legendFormat": "started",
          "refId": "A"
        },
        {
          "expr": "sum(rate(game_hands_completed_total[5m]))",
          "legendFormat": "completed",
          "refId": "B"
        }
      ],
      "title": "Hands Started vs Completed (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "id": 5,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (outcome) (rate(game_hands_completed_total[5m]))",
          "legendFormat": "{{outcome}}",
          "refId": "A"
        }
      ],
      "title": "Hand Outcomes (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 48 },
      "id": 6,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(game_grpc_request_duration_seconds_bucket[5m])) by (le, method))",
          "legendFormat": "{{method}}",
          "refId": "A"
        }
      ],
      "title": "Game gRPC Latency p95 by Method",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 48 },
      "id": 10,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "game_spectators_total",
          "legendFormat": "spectators",
          "refId": "A"
        },
        {
          "expr": "game_seated_players",
          "legendFormat": "seated players",
          "refId": "B"
        }
      ],
      "title": "Spectators vs Seated Players",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 56 },
      "id": 500,
      "title": "Economy & Events",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 57 },
      "id": 8,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (type) (rate(balance_transactions_total[5m]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ],
      "title": "Balance Transactions by Type (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 57 },
      "id": 9,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (action) (rate(balance_velocity_chips_total[5m]))",
          "legendFormat": "{{action}}",
          "refId": "A"
        }
      ],
      "title": "Balance Velocity (chips/sec)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 57 },
      "id": 11,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "balance_total_supply",
          "legendFormat": "total supply",
          "refId": "A"
        },
        {
          "expr": "balance_active_pot_total",
          "legendFormat": "active pot",
          "refId": "B"
        }
      ],
      "title": "Economy Totals",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 65 },
      "id": 12,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (type) (rate(event_ingestion_total[5m]))",
          "legendFormat": "{{type}}",
          "refId": "A"
        }
      ],
      "title": "Event Ingestion by Type (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 65 },
      "id": 501,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (status) (rate(notify_push_delivery_total[5m]))",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "title": "Notify Push Deliveries (5m rate)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 73 },
      "id": 550,
      "title": "User Experience",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 74 },
      "id": 551,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (client_type) (gateway_ws_active_connections)",
          "legendFormat": "{{client_type}}",
          "refId": "A"
        }
      ],
      "title": "WS Active Connections",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 74 },
      "id": 552,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(gateway_ws_session_duration_seconds_bucket[5m])) by (le, client_type))",
          "legendFormat": "{{client_type}}",
          "refId": "A"
        }
      ],
      "title": "WS Session Duration p95",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 74 },
      "id": 553,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(gateway_http_request_duration_seconds_bucket[5m])) by (le))",
          "legendFormat": "p95",
          "refId": "A"
        }
      ],
      "title": "Gateway HTTP Latency p95",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "percent" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 82 },
      "id": 554,
      "options": {
        "colorMode": "value",
        "graphMode": "none",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "(100 * sum(rate(game_seat_joins_total{status=\"ok\"}[5m])) / clamp_min(sum(rate(game_seat_joins_total[5m])), 1)) or vector(0)",
          "legendFormat": "Join Success",
          "refId": "A"
        }
      ],
      "title": "Seat Join Success (%)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 82 },
      "id": 555,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (reason) (rate(game_seat_joins_total{status=\"error\"}[5m]))",
          "legendFormat": "{{reason}}",
          "refId": "A"
        }
      ],
      "title": "Seat Join Failures (5m rate)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 82 },
      "id": 556,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (street, action_type) (rate(game_turn_timeouts_total[5m]))",
          "legendFormat": "{{street}} {{action_type}}",
          "refId": "A"
        }
      ],
      "title": "Turn Timeouts (5m rate)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 90 },
      "id": 560,
      "title": "Compute Utilization",
      "type": "row"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": {},
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 91 },
      "id": 561,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (job) (rate(process_cpu_user_seconds_total[5m]) + rate(process_cpu_system_seconds_total[5m]))",
          "legendFormat": "{{job}}",
          "refId": "A"
        }
      ],
      "title": "CPU (cores)",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "bytes" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 91 },
      "id": 562,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum by (job) (process_resident_memory_bytes)",
          "legendFormat": "{{job}}",
          "refId": "A"
        }
      ],
      "title": "Memory RSS",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "PROMETHEUS"
      },
      "fieldConfig": {
        "defaults": { "unit": "s" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 91 },
      "id": 563,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "max by (job) (nodejs_eventloop_lag_p99_seconds)",
          "legendFormat": "{{job}}",
          "refId": "A"
        }
      ],
      "title": "Event Loop Lag p99",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 99 },
      "id": 600,
      "title": "Logs & Traces",
      "type": "row"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "LOKI"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 100 },
      "id": 601,
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "targets": [
        {
          "expr": "sum(count_over_time({service=~\".+\"}[$__interval]))",
          "refId": "A"
        }
      ],
      "title": "Log Volume",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "LOKI"
      },
      "fieldConfig": {
        "defaults": { "unit": "short" },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 100 },
      "id": 602,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "targets": [
        {
          "expr": "sum(count_over_time({service=~\".+\"} |= \"error\" [$__interval]))",
          "refId": "A"
        }
      ],
      "title": "Error Logs (interval)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "LOKI"
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 108 },
      "id": 603,
      "options": {
        "dedupStrategy": "none",
        "showLabels": true,
        "showTime": true,
        "sortOrder": "Descending",
        "wrapLogMessage": true
      },
      "targets": [
        {
          "expr": "{service=~\".+\"}",
          "refId": "A"
        }
      ],
      "title": "Recent Logs",
      "type": "logs"
    },
    {
      "datasource": {
        "type": "tempo",
        "uid": "TEMPO"
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 118 },
      "id": 604,
      "targets": [
        {
          "queryType": "search",
          "query": "{}",
          "refId": "A"
        }
      ],
      "title": "Recent Traces",
      "type": "traces"
    }
  ],
  "refresh": "10s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["poker", "ux"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "title": "Poker Observability",
  "uid": "poker-observability",
  "version": 4
}
